<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>剪影文档工坊 | Silhouette Studio</title>

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- Word to PDF Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <h1>Silhouette <span>Studio</span></h1>
        <p>PDF 合并 · 图片排版 · 电子签名</p>
    </header>

    <div class="app-container">
        <div class="tabs">
            <button class="tab-btn active" id="tab-merge" onclick="switchMode('merge')">
                <i class="fas fa-file-pdf"></i> PDF 合并
            </button>
            <button class="tab-btn" id="tab-image" onclick="switchMode('image')">
                <i class="fas fa-images"></i> 图片转 PDF
            </button>
            <button class="tab-btn" id="tab-word" onclick="switchMode('word')">
                <i class="fas fa-file-word"></i> Word 转 PDF
            </button>
            <button class="tab-btn" id="tab-editor" onclick="switchMode('editor')">
                <i class="fas fa-edit"></i> 图片编辑
            </button>
        </div>

        <!-- Main Section (Merge & Image2PDF & Word2PDF) -->
        <div id="main-section">
            <div class="section-block">
                <div class="section-title">1. 添加文件</div>
                <div class="upload-zone" id="drop-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <div id="drop-text" style="font-size:0.9rem; color:#ccc;">点击添加文件</div>
                    <input type="file" id="file-input" multiple>
                </div>

                <div id="upload-progress-container">
                    <div class="progress-info">
                        <span id="progress-status">正在读取...</span>
                        <span id="upload-progress-text">0%</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="upload-progress-fill"></div>
                    </div>
                </div>

                <div class="file-list-container">
                    <ul class="file-list" id="file-list"></ul>
                </div>
            </div>

            <div class="section-block signature-section">
                <div class="sig-header">
                    <div class="section-title" style="margin:0">2. 电子签名 (可选)</div>
                    <button class="btn-add-sig" id="btn-open-sig">+ 创建/修改签名</button>
                </div>

                <div class="sig-preview-box" id="sig-config">
                    <div class="sig-img-wrap">
                        <img id="sig-preview-img" src="" alt="Signature">
                        <button class="btn-del-sig" onclick="removeSignature()">×</button>
                    </div>

                    <div class="sig-controls">
                        <div class="control-row">
                            <span>应用范围:</span>
                            <select class="scope-select" id="sig-scope">
                                <option value="last" selected>仅最后一页</option>
                                <option value="first">仅第一页</option>
                                <option value="all">每一页</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <button class="btn-placement" onclick="openPlacementModal()">
                                <i class="fas fa-arrows-alt"></i> 调整位置与大小
                            </button>
                        </div>
                        <div class="control-row"
                            style="justify-content: flex-start; gap: 10px; font-size: 0.75rem; color: #666;">
                            <i class="fas fa-info-circle"></i> <span>点击上方按钮可拖拽调整位置</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-bar">
                <span style="color:#888; font-size:0.85rem" id="status-text">准备就绪</span>
                <button class="btn-merge" id="merge-btn">
                    <div class="loader" id="loader"></div>
                    <span id="btn-text">生成 PDF</span>
                </button>
            </div>
        </div>

        <!-- Image Editor Section -->
        <div id="editor-section" style="display: none;">
            <div class="upload-zone" id="editor-drop-area">
                <i class="fas fa-image"></i>
                <div style="font-size:0.9rem; color:#ccc;">点击或拖拽图片开始编辑</div>
            </div>

            <div id="editor-workspace" style="display: none;">
                <div class="editor-layout">
                    <div class="editor-canvas-box">
                        <img id="editor-image" src="" style="max-width: 100%; max-height: 100%;">
                    </div>

                    <div class="editor-sidebar">
                        <div class="tool-group">
                            <div class="tool-title"><i class="fas fa-sliders-h"></i> 色相与饱和度</div>
                            <div class="slider-row">
                                <span>色相</span>
                                <input type="range" id="edit-hue" min="-180" max="180" value="0">
                                <span class="val" id="val-hue">0</span>
                            </div>
                            <div class="slider-row">
                                <span>饱和</span>
                                <input type="range" id="edit-sat" min="0" max="200" value="100">
                                <span class="val" id="val-sat">100%</span>
                            </div>
                        </div>

                        <div class="tool-group">
                            <div class="tool-title"><i class="fas fa-crop-alt"></i> 裁剪</div>
                            <button class="btn-tool" id="btn-toggle-crop">进入裁剪模式</button>
                            <div id="crop-actions" style="display: none; gap: 5px;">
                                <button class="btn-tool confirm" id="btn-confirm-crop"><i
                                        class="fas fa-check"></i></button>
                                <button class="btn-tool cancel" id="btn-cancel-crop"><i
                                        class="fas fa-times"></i></button>
                            </div>
                        </div>

                        <div class="tool-group">
                            <div class="tool-title"><i class="fas fa-expand"></i> 调整尺寸 (px)</div>
                            <div class="resize-inputs">
                                <input type="number" id="edit-w" placeholder="宽">
                                <span style="color:#666">x</span>
                                <input type="number" id="edit-h" placeholder="高">
                            </div>
                            <div class="checkbox-row">
                                <input type="checkbox" id="lock-ratio" checked>
                                <label for="lock-ratio">锁定长宽比</label>
                            </div>
                            <button class="btn-tool primary" id="btn-apply-resize"
                                style="margin-top: 8px;">应用尺寸</button>
                        </div>

                        <div class="editor-actions">
                            <button class="btn-tool danger" id="btn-reset-edit">重置所有</button>
                            <button class="btn-tool primary" id="btn-download-edit">导出图片</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="sig-modal">
        <div class="modal-box">
            <div class="modal-title">请在下方签署姓名</div>
            <div class="canvas-wrapper">
                <canvas id="sig-canvas"></canvas>
            </div>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="closeSigModal()">取消</button>
                <button class="btn-modal btn-clear" onclick="clearCanvas()">清除</button>
                <button class="btn-modal btn-save" onclick="saveSignature()">确认使用</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="placement-modal">
        <div class="modal-box large-modal">
            <div class="modal-title">拖拽签名调整位置</div>

            <div class="placement-container-wrapper">
                <div id="a4-preview-container">
                    <div class="grid-lines"></div>
                    <div id="draggable-sig">
                        <img id="drag-sig-img" src="">
                        <div class="resize-handle"></div>
                    </div>
                    <div class="page-label">A4 页面预览</div>
                </div>
            </div>

            <div class="placement-controls">
                <span>签名大小:</span>
                <input type="range" id="drag-scale-slider" min="20" max="150" value="60">
            </div>

            <div class="modal-actions">
                <button class="btn-modal btn-save" onclick="closePlacementModal()">完成调整</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>